function cercle(id,colorC=0,color=0){var canvas=document.getElementById(id),context=canvas.getContext("2d"),X=canvas.width/2,Y=canvas.height/2,R=45;context.beginPath(),0!=colorC&&(context.strokeStyle=colorC),0!=color&&(context.fillStyle=color),context.lineWidth="8",context.arc(X,Y,R,0,2*Math.PI,!1),0!=colorC&&context.stroke(),0!=color&&context.fill()}function triangle(id,colorC,color){var canvas,ctx=document.getElementById(id).getContext("2d");ctx.beginPath(),ctx.strokeStyle=colorC,ctx.lineWidth="7",ctx.moveTo(50,7),ctx.lineTo(5,95),ctx.lineTo(95,95),ctx.lineTo(50,7),ctx.closePath(),ctx.stroke(),ctx.fillStyle=color,ctx.fill()}function carre(id,x,y,w,colorC=0,color=0){var canvas,context=document.getElementById(id).getContext("2d");context.beginPath(),0!=colorC&&(context.strokeStyle=colorC),context.lineWidth="8",context.rect(x,y,w,w),0!=color&&(context.fillStyle=color),0!=colorC&&context.stroke(),0!=color&&context.fill()}function etoile(id,cx,cy,spikes,outerRadius,innerRadius,colorC=0,color=0){var canvas,ctx=document.getElementById(id).getContext("2d"),rot=Math.PI/2*3,x=cx,y=cy,step=Math.PI/spikes;for(0!=colorC&&(ctx.strokeStyle=colorC),ctx.beginPath(),ctx.moveTo(cx,cy-outerRadius),i=0;i<spikes;i++)x=cx+Math.cos(rot)*outerRadius,y=cy+Math.sin(rot)*outerRadius,ctx.lineTo(x,y),rot+=step,x=cx+Math.cos(rot)*innerRadius,y=cy+Math.sin(rot)*innerRadius,ctx.lineTo(x,y),rot+=step;ctx.lineTo(cx,cy-outerRadius),ctx.closePath(),ctx.lineWidth=7,0!=colorC&&(ctx.strokeStyle=colorC),ctx.stroke(),0!=color&&(ctx.fillStyle=color),ctx.fill()}function shuffle(a){for(var j=0,valI="",valJ=valI,l=a.length-1;l>-1;)j=Math.floor(Math.random()*l),valI=a[l],valJ=a[j],a[l]=valJ,a[j]=valI,l-=1;return a}let couleurs=["red","MediumBlue","yellow","darkgreen","Indigo","DarkRed","deeppink","DarkOrange"],couleursOrder=[].concat(couleurs),nbFormes=0,couleursNiv=couleurs.slice(0,nbFormes);function toggleSound(){var myMusic=document.getElementById("music");myMusic.loop=!0,myMusic.paused?myMusic.play():myMusic.pause()}function GoInFullscreen(element){element.requestFullscreen?element.requestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen():element.msRequestFullscreen&&element.msRequestFullscreen()}$(document).ready((function(){for($i=1;$i<=10;$i++)$2et=$("#2et_level_"+$i).html(),$3et=$("#3et_level_"+$i).html(),console.log("level "+$i+" : "+$2et+" "+$3et);function shuffle($tab){for($j=0,$valI="",$valJ=$valI,$l=$tab.length-1;$l>-1;)$j=Math.floor(Math.random()*$l),$valI=$tab[$l],$valJ=$tab[$j],$tab[$l]=$valJ,$tab[$j]=$valI,$l-=1;return $tab}function suiteRandom(){for($suites=[],$x1=[],$x2=[],$y=0;$y<$nbFormes;$y++)$suites[$y]=$y}$icon=$("#playerMusic"),$music=$("#music"),$music.prop("volume",.7),$icon.mouseenter((function(){$music.prop("controls",!0)})),$("#audioTool").mouseleave((function(){$music.prop("controls",!1)})),$icon.click((function(){"img/audio/music-off.png"==$icon.attr("src")?($icon.removeAttr("src"),$icon.attr("src","img/audio/music-on.png")):($icon.removeAttr("src"),$icon.attr("src","img/audio/music-off.png"))})),$couleurs=["red","MediumBlue","yellow","darkgreen","black","Indigo","DarkRed","deeppink","DarkOrange"],$couleursOrder=[].concat($couleurs),ion.sound({sounds:[{name:"success",volume:.1},{name:"success_level",volume:.1},{name:"success_game",volume:.2}],volume:.2,path:"sounds/",preload:!0}),$bruit=$("#toggleBruit"),$bruit.click((function(){"img/audio/bruit-off.png"==$bruit.attr("src")?($bruit.removeAttr("src"),$bruit.attr("src","img/audio/bruit-on.png")):($bruit.removeAttr("src"),$bruit.attr("src","img/audio/bruit-off.png"))})),$nbEtoiles="",$nbClick=0,$nbCarres=3,$nbFormes=0,$nbCouleurs=0,$dureeTotale=0,$scoreEtoiles=0,$nbLevels=10;let nbClick=$nbClick,date=new Date(Date.now()+864e5);function formesCible(){for($formesCibles=[],"fit"==$difficulte?window.innerWidth<1e3?$d="17%":$d="16%":$d="15%",$z=0;$z<$nbFormes;$z++)$formesCibles[$z]='<canvas id="formeCible'+$z+'" width="100" height="100" style ="width :'+$d+' ; height : auto ;" class="draggable mx-3 mb-2"></canvas><br>'}function formesOrigine(){for($formes=[],$z=0;$z<$nbFormes;$z++)$formes[$z]='<canvas id="forme'+$z+'" width="100" height="100" style ="width :8% ; height : auto; z-index: 999" class="bg-darky2 mx-3"></canvas><br>'}function affich(){$("#containerOrigin").hide(),$nbClick>8&&$nbClick<=10&&($("#panier_1").remove(),$("#panier_2").remove()),$fin=new Date,$finMs=$fin.getTime(),$duree=($finMs-$debutMs)/1e3,$dureePartieParLevel.push($duree),10==$nbClick&&($finPartieMs=$finMs),$nbClick<=9&&($("#containerCible").css("background-image","none"),$nbClick<9?$("#containerCible").css("bottom","80%"):$("#containerCible").css("bottom","80%").css("right","80%"),$("#cible").css("bottom","72%"),$(".reussiteCorrespondance_"+$rand).hide(),$("#nextLevel").fadeIn(500),"img/audio/bruit-on.png"==$bruit.attr("src")&&ion.sound.play("success_level")),$("#successLevel").removeAttr("src"),$duree<parseInt($("#3et_level_"+$nbClick).html())?($nbEtoiles=3,$("#successLevel").attr("src","img/game/3etoiles-500.png")):$duree>parseInt($("#2et_level_"+$nbClick).html())?($nbEtoiles=1,$("#successLevel").attr("src","img/game/1etoile-500.png")):($nbEtoiles=2,$("#successLevel").attr("src","img/game/2etoiles-500.png")),$scorePartieParLevel.push($nbEtoiles),$scoreEtoiles+=$nbEtoiles,$("#scoreAffiche").text($scoreEtoiles),$scoreTotalAfficher=parseInt($scoreTotal)+parseInt($scoreEtoiles),$("#scoreCumul").text($scoreTotalAfficher),console.log("####################################################################################################"),console.log("level "+$nbClick),console.log("Temps réalisé (en s) : "+$duree),console.log("Nombre d'étoiles gagnées dans ce niveau: "+$nbEtoiles),console.log("Nombre d'étoiles cumulées au cours de la partie : "+$scoreEtoiles),console.log("Tab qui renvoie le score par niveau : "+$scorePartieParLevel),console.log("Tab qui renvoie le temps réalisé par level : "+$dureePartieParLevel),console.log("####################################################################################################");let score=$nbEtoiles;document.cookie="score"+nbClick+"="+score+"; path=/; expires="+date;let temps=$duree;document.cookie="temps"+nbClick+"="+temps+"; path=/; expires="+date}date=date.toUTCString(),$difficulte="",$choixJoueur=$("#choixDiff").text(),$snapTolerance=0,console.log($choixJoueur),"facile"==$choixJoueur&&($difficulte="pointer",$snapTolerance=20),"moyen"==$choixJoueur&&($difficulte="intersect",$snapTolerance=10),"difficile"==$choixJoueur&&($difficulte="fit",$snapTolerance=0),$d=0,$scoreTotal=$("#scoreCumulInit").text(),$scoreTotalAfficher=parseInt($scoreTotal),$("#scoreCumul").text($scoreTotalAfficher),$dureePartieParLevel=[],$scorePartieParLevel=[],$(".ecouteurJeu").click((function(){for($debut=new Date,$debutMs=$debut.getTime(),$debutPartieMs=$debutMs,$nbClick++,console.log("Début (en ms) du level "+$nbClick+" : "+$debutMs),console.log("le nombre de clicks est de "+$nbClick),$nbClick=1;$nbClick<=$nbLevels;$nbClick++){if(nbClick=$i,$("#containerCible").css("background-image","url('../img/tab-f2.png')"),$("#containerCible").css("bottom","10%"),$("#cible").css("bottom","52%"),couleurTab=[],1==$nbClick&&($("div").remove(".radialtimer"),window.innerWidth<890?(GoInFullscreen($("#element").get(0)),$("#fullScreen").attr("src","img/reduce-128-blue.png"),$(".fullScreen").css("display","initial")):($("#fullScreen").attr("src","img/expand-128-blue.png"),$(".fullScreen").css("display","initial")),$("#lancerJeu").fadeOut(500,(function(){$("#containerOrigin").fadeIn(600)})),$("#score").fadeIn(600),$("#player").fadeIn(600)),$nbClick>1&&($("#containerOrigin").fadeIn(600),$("#levelNumber").text("Niveau "+$i),$("#successLevel").removeAttr("src"),$("#nextLevel").fadeOut(500)),$nbClick<5){for($nbCarres=3+2*($i-1),$nbCouleurs=3+2*($i-1),$couleurs=shuffle($couleurs),$couleursNiv=$couleursOrder.slice(0,$nbCouleurs),$couleurCibles=shuffle($couleursNiv),$d=0,"fit"==$difficulte?window.innerWidth<1e3?$d="18%":$d="16%":$d="15%",$i=0;$i<$nbCarres;$i++)$("#cible").append('<canvas id="carre_'+$i+'" width="100" height="100" style ="width :'+$d+' ; height : auto ;" class="draggable mx-2 mb-2"></canvas>');for($("#origin").empty(),$i=0;$i<$couleurs.length;$i++)$("#origin").append('<canvas id="carre_'+$couleurs[$i]+'" width="80" height="80"  style ="width :8% ; height : auto ; z-index: 999;" class="bg-darky mx-2"></canvas>');for($i=0;$i<$couleurs.length;$i++)carre("carre_"+$couleurs[$i],0,0,80,0,$couleurs[$i]);for($couleursNiv=$couleursOrder.slice(0,$nbCouleurs),$couleurCibles=shuffle($couleursNiv),$i=0;$i<$nbCouleurs;$i++)carre("carre_"+$i,10,10,80,"black",$couleurCibles[$i]);for(console.log("$couleurCibles : random des n premieres couleurs de la palette (par level) : "+$couleurCibles),console.log("$couleurs : doit censé renvoyé un random de la color palette : "+$couleurs),console.log(window.innerWidth),$i=0;$i<9;$i++)$("#carre_"+$couleurs[$i]).draggable({containment:"body",snap:".draggable",snapTolerance:$snapTolerance,revert:"invalid",cursor:"pointer"});for($nb=0,$i=0;$i<$nbCarres;$i++)$("#carre_"+$i).droppable({accept:"#carre_"+$couleurCibles[$i],tolerance:$difficulte,drop:function(event,ui){"img/audio/bruit-on.png"==$bruit.attr("src")&&ion.sound.play("success"),$(ui.draggable).remove(),$rand=Math.floor(Math.random()*Math.floor(13))+1,console.log($rand),$(".reussiteCorrespondance_"+$rand).show().fadeIn(500).delay(1200).fadeOut(200,(function(){$(this).hide()})),$(this).effect("pulsate").addClass("correct").delay(1e3).fadeOut(300,(function(){$(this).remove(),$nb++,$nb==$nbCarres&&affich()}))}})}if($nbClick>4&&$nbClick<9){for($nbFormes=-2+$i,nbFormes=-2+$i,couleurTab[$i-5]=[],$("#cible").empty(),$("#origin").empty(),couleurTab[$i-5]=shuffle(couleursOrder),couleurTab[$i-5]=[].concat(couleurTab[$i-5]),console.log(couleurTab),suiteRandom(),$x1=shuffle($suites),$x1=[].concat($x1),formesCible(),$j=0;$j<$formesCibles.length;$j++)$("#cible").append($formesCibles[$x1[$j]]);for($x2=shuffle($x1),$x2=[].concat($x2),formesOrigine(),$j=0;$j<$formes.length;$j++)$("#origin").append($formes[$x2[$j]]);for($i>=5&&(cercle("formeCible0","black",couleurTab[$i-5][0]),triangle("formeCible1","black",couleurTab[$i-5][3]),carre("formeCible2",10,10,80,"black",couleurTab[$i-5][2]),cercle("forme0","black",couleurTab[$i-5][0]),triangle("forme1","black",couleurTab[$i-5][3]),carre("forme2",10,10,80,"black",couleurTab[$i-5][2]),$i>=6&&(etoile("formeCible3",50,52,5,45,25,"black",couleurTab[$i-5][1]),etoile("forme3",50,52,5,45,25,"black",couleurTab[$i-5][1]),$i>=7&&(carre("formeCible4",10,10,80,"black",couleurTab[$i-5][4]),carre("forme4",10,10,80,"black",couleurTab[$i-5][4]),8==$i&&($random=Math.floor(Math.random()*Math.floor(3)),0==$random&&(triangle("formeCible5","black",couleurTab[$i-5][5]),triangle("forme5","black",couleurTab[$i-5][5])),1==$random&&(cercle("formeCible5","black",couleurTab[$i-5][5]),cercle("forme5","black",couleurTab[$i-5][5])),2==$random&&(etoile("formeCible5",50,52,5,45,25,"black",couleurTab[$i-5][5]),etoile("forme5",50,52,5,45,25,"black",couleurTab[$i-5][5])))))),$j=0;$j<$nbFormes;$j++)$("#forme"+$j).draggable({containment:"body",snap:".draggable",snapTolerance:$snapTolerance,revert:"invalid",cursor:"pointer"});for($nb=0,$j=0;$j<$nbFormes;$j++)$("#formeCible"+$j).droppable({accept:"#forme"+$j,tolerance:$difficulte,drop:function(event,ui){"img/audio/bruit-on.png"==$bruit.attr("src")&&ion.sound.play("success"),$(ui.draggable).remove(),$rand=Math.floor(Math.random()*Math.floor(13))+1,console.log($rand),$(".reussiteCorrespondance_"+$rand).show().fadeIn(500).delay(1200).fadeOut(200,(function(){$(this).hide()})),$(this).effect("pulsate").addClass("correct").delay(500).fadeOut(300,(function(){$(this).remove(),$nb++,$nb==$nbFormes&&affich()}))}})}if($nbClick>=9){for($nb=0,$i=0;$i<$nbFruits;$i++)$("#fruitCible_"+$i).draggable({containment:"body",snap:".draggable",snapTolerance:$snapTolerance,revert:"invalid"});for($i=1;$i<3;$i++)$("#panier_"+$i).droppable({accept:".drop"+$i,tolerance:$difficulte,drop:function(event,ui){"img/audio/bruit-on.png"==$bruit.attr("src")&&ion.sound.play("success"),$(ui.draggable).remove(),$rand=Math.floor(Math.random()*Math.floor(13))+1,console.log($rand),$(".reussiteCorrespondance_"+$rand).show().fadeIn(500).delay(1200).fadeOut(200,(function(){$(this).hide()})),$(this).addClass("correct").effect("pulsate").delay(500).fadeOut(300,(function(){if($(this).removeClass("correct").delay(1500).fadeOut(),$nb++,$nb==$nbFruits&&(affich(),10==$nbClick)){var myMusic;if($("#successLevel").delay(2500).hide(),$("#containerCible").css("bottom","70%"),$dureePartie=0,$dureePartieMinutes=0,$dureePartieSecondes=0,"img/audio/music-on.png"==$icon.attr("src")&&"img/audio/bruit-on.png"==$bruit.attr("src"))document.getElementById("music").pause(),ion.sound.play("success_game");const colors=["#3CC157","#2AA7FF","#1B1B1B","#FCBC0F","#F85F36"],numBalls=100,balls=[];for(let i=0;i<numBalls;i++){let ball=document.createElement("div");ball.classList.add("ball"),ball.style.background=colors[Math.floor(Math.random()*colors.length)],ball.style.left=`${Math.floor(100*Math.random())}vw`,ball.style.top=`${Math.floor(100*Math.random())}vh`,ball.style.transform=`scale(${Math.random()})`,ball.style.width=`${Math.random()}em`,ball.style.height=ball.style.width,balls.push(ball),document.body.append(ball)}for(balls.forEach((el,i,ra)=>{let to_x=Math.random()*(i%2==0?-11:11),to_y=12*Math.random(),anim=el.animate([{transform:"translate(0, 0)"},{transform:`translate(${to_x}rem, ${to_y}rem)`}],{duration:2e3*(Math.random()+1),direction:"alternate",fill:"both",iterations:1/0,easing:"ease-in-out"})}),$i=0;$i<$dureePartieParLevel.length;$i++)$dureePartie+=$dureePartieParLevel[$i];$dureePartie=Math.round($dureePartie),$dureePartieMinutes=Math.floor($dureePartie/60),$dureePartieSecondes=$dureePartie%60,console.log("####################################################################################################"),console.log("Temps total en secondes : "+$dureePartie),console.log("Temps total en min:s : "+$dureePartieMinutes+" : "+$dureePartieSecondes),console.log("Nombre d'étoiles cumulées au cours de la partie : "+$scoreEtoiles),console.log("Tab qui renvoie le temps réalisé par level : "+$dureePartieParLevel),console.log("####################################################################################################"),$("#gameFinished").show(100),$("#gameEnd").show(300),$("#gameFinished").append('<span id="msgGameFinished" class="msgVictoire">Bravo, tu as gagné '+$scoreEtoiles+' etoiles au cours de cette partie !"</span><br>'),$("#gameFinished").append('<span id="msgGameFinished" class="msgVictoire">Tu as terminé Color-Drop en '+$dureePartieMinutes+" minutes et "+$dureePartieSecondes+' secondes.")</span>');let scoreTotal=$scoreEtoiles;document.cookie="scoreTotal="+scoreTotal+"; path=/; expires="+date}$("#panier_"+$i).removeClass("correct")}))}})}}}))}));